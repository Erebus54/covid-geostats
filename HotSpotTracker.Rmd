---
title: "HotSpotTracker"
author: Patrick Reza Schnurbusch 
date: '`r paste("Updated: ", format(Sys.time(), "%Y-%m-%d"))`'
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    social: menu
    theme: paper
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)

library(geojsonio)
library(leaflet)
library(leaflet.extras)
library(leaflet.providers)
library(sf)

library(dplyr)
library(tidyr)

library(lubridate)

#read polygon data 
# loc = "https://opendata.arcgis.com/datasets/d8fba69152e4408dabfe70e85a2688d2_44.geojson"
# PHU_boundaries <- geojsonio::geojson_read(loc, what = "sp")
# 
# PHU_boundaries_sf <- sf::st_as_sf(PHU_boundaries)


library("rgdal")
#write polygon data
# st_write(PHU_boundaries_sf, "./spatial files/PHU_Boundaries.geojson")

#read file in 
PHU_boundaries_sf <-  geojsonio::geojson_read("./spatial files/PHU_Boundaries.geojson" , what = "sp")
PHU_boundaries_sf <- sf::st_as_sf(PHU_boundaries_sf)
```

GIS
===================================== 
Row {.tabset .tabset-fade}
-------------------------------------

```{r}
#download casestatus data 
PHU_csums <- read.csv("./dataset/PHU_Summary.csv", encoding = "UTF-8")
#merging 
csum_map <- merge(PHU_boundaries_sf, PHU_csums, by.x = "PHU_NAME_ENG", by.y = "Reporting_PHU" )
```


### <b> Choropleth Map </b> 
```{r}
 
pal <- colorNumeric("RdBu", domain = csum_map$Total_Cases, reverse = T)
 
leaflet() %>% 
   setView(lat = 51.2538, lng = -85.3232, zoom = 5.25) %>%
   addProviderTiles(providers$CartoDB.Positron) %>% 
   addPolygons(data  = csum_map,
               fillColor = ~pal(Total_Cases), 
               weight = 2, 
               opacity = 1, 
               color = "white", 
               dashArray = 3, 
               fillOpacity = 0.25, 
               
               highlightOptions = highlightOptions(
                 weight = 4, 
                 color = "yellow", 
                 fillOpacity = 0.5, 
                 bringToFront = T), 
               
               labelOptions = labelOptions(
                 style = list("font-weight" = "normal", padding = "3px 8px"),
                 textsize = "15px",
                 direction = "auto")
               ) %>%
   addFullscreenControl() %>% 
   addResetMapButton() %>% 
   addLegend("bottomright", pal = pal, values = csum_map$Total_Cases, 
             title = "Total Cases", 
             opacity = 0.5)
```

### <b> Cartogram </b> 

```{r carto}
#making a cartogram of the total cases by area
library(rgeos)
library(cartogram)
library(spatstat)

carto_ref <- cartogram_cont(csum_map, "Total_Cases")
plot(carto_ref)
```

GeoStatistics
===================================== 
Row {.tabset .tabset-fade}
-------------------------------------

### <b> Spatial Autocorrelation </b> 
### <b> Confidence Intervals </b> 

